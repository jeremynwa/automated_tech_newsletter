<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech Digest</title>

    <!-- External CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/main.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/advanced-features.css') }}"
    />

    <!-- jsPDF library for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>

  <body>
    <!-- Progress bar -->
    <div class="progress-bar" id="progress-bar"></div>

    <!-- Page transition overlay -->
    <div class="page-transition" id="page-transition"></div>

    <!-- TOC Toggle (mobile) -->
    <button class="toc-toggle" id="toc-toggle" aria-label="Toggle navigation">
      â˜°
    </button>

    <!-- TOC Overlay (mobile) -->
    <div class="toc-overlay" id="toc-overlay"></div>

    <div class="layout">
      <!-- Sidebar -->
      <aside class="toc-sidebar" id="toc-sidebar">
        <div class="saved-box">
          <button class="home-button" id="home-button">
            <span>ğŸ </span><span>Home</span>
          </button>
          <button class="view-saved-button" id="view-saved-button">
            <span>ğŸ“Œ Saved Articles</span>
            <span class="saved-badge" id="saved-badge">0</span>
          </button>
        </div>

        <div class="toc-container">
          <h3 class="toc-title">ğŸ“… Dates</h3>
          <ul class="toc-list" id="toc-list"></ul>
        </div>
      </aside>

      <div class="container">
        <header>
          <h1>Tech Digest</h1>
          <p class="subtitle">
            Daily AI, Tech News, Research & Hacker News Summaries
          </p>
          <div class="listen-banner">
            <button class="global-play-button" id="global-play-button">
              <span class="play-icon" id="global-play-icon">â–¶</span>
              <span id="global-play-text">Listen to Newsletter</span>
              <span class="reading-time" id="reading-time">(~5 min)</span>
            </button>
          </div>
          <div class="header-controls">
            <button class="export-pdf-button" id="export-pdf-button">
              <span>ğŸ“„</span><span>Export PDF</span>
            </button>
            <button class="theme-toggle" id="theme-toggle">
              <span class="theme-icon" id="theme-icon">ğŸŒ™</span>
              <span id="theme-text">Dark Mode</span>
            </button>
          </div>
        </header>

        <div class="filter-bar">
          <div class="filter-section">
            <label class="filter-label">Search Keywords</label>
            <div class="filter-options">
              <input
                type="text"
                class="search-input"
                placeholder="Search articles by keyword..."
                id="keyword-search"
              />
            </div>
          </div>

          <div class="filter-section">
            <label class="filter-label">Time Range</label>
            <div class="filter-options">
              <button class="filter-btn active" data-range="all">All</button>
              <button class="filter-btn" data-range="today">Today</button>
              <button class="filter-btn" data-range="3days">Last 3 Days</button>
              <button class="filter-btn" data-range="week">Last Week</button>
              <button class="filter-btn" data-range="month">Last Month</button>
              <input type="date" class="custom-date-input" id="custom-date" />
            </div>
          </div>

          <div class="filter-section">
            <label class="filter-label">Content Type</label>
            <div class="filter-options">
              <button class="filter-btn active" data-type="tech">
                World Tech News
              </button>
              <button class="filter-btn active" data-type="hn">
                Hacker News
              </button>
              <button class="filter-btn active" data-type="research">
                Research Papers
              </button>
            </div>
          </div>

          <div class="active-filters" id="active-filters"></div>
          <button class="search-button" id="apply-filters">
            Apply Filters
          </button>
        </div>

        <!-- Saved Articles View -->
        <div class="saved-articles-view hidden" id="saved-articles-view">
          <div class="saved-articles-header">
            <h2 class="saved-articles-title">ğŸ“Œ Saved Articles</h2>
            <button class="close-saved-view" id="close-saved-view">
              Close
            </button>
          </div>
          <div id="saved-articles-list"></div>
        </div>

        <div class="feed" id="feed">
          {% for digest in digests %}
          <div class="digest-day" data-date="{{ digest.date }}">
            <div class="day-separator">
              <div class="date-text">{{ digest.formatted_date }}</div>
            </div>
            <div class="day-content">{{ digest.content|safe }}</div>
          </div>
          {% endfor %}
        </div>

        <div class="no-results hidden" id="no-results">
          <h2>No Results Found</h2>
          <p>Try adjusting your filters or search terms</p>
        </div>
      </div>
    </div>

    <button class="back-to-top" id="back-to-top" aria-label="Back to top">
      â†‘
    </button>

    <!-- Floating TTS Player (appears when playing) -->
    <div class="floating-tts-player hidden" id="floating-tts-player">
      <button class="floating-tts-control" id="floating-tts-control">
        <span class="floating-tts-icon" id="floating-tts-icon">â¸</span>
      </button>
      <button
        class="floating-tts-skip"
        id="floating-tts-skip"
        title="Skip to next article"
      >
        â­
      </button>
      <div class="floating-tts-info">
        <span id="floating-tts-status">Playing...</span>
      </div>
      <button class="floating-tts-stop" id="floating-tts-stop" title="Stop">
        âœ•
      </button>
    </div>

    <button class="fab" id="fab" aria-label="Quick actions">âš¡</button>

    <div class="fab-menu" id="fab-menu">
      <button class="fab-menu-item" id="fab-theme">
        <span class="fab-menu-item-icon" id="fab-theme-icon">ğŸŒ™</span>
        <span id="fab-theme-text">Dark Mode</span>
      </button>
      <button class="fab-menu-item" id="fab-saved">
        <span class="fab-menu-item-icon">ğŸ“Œ</span>
        <span>Saved (<span id="fab-saved-count">0</span>)</span>
      </button>
      <button class="fab-menu-item" id="fab-scroll-top">
        <span class="fab-menu-item-icon">â†‘</span>
        <span>Back to Top</span>
      </button>
    </div>

    <!-- External JS -->
    <script
      src="{{ url_for('static', filename='js/theme.js') }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/progress.js') }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/filters.js') }}"
      defer
    ></script>
    <script src="{{ url_for('static', filename='js/toc.js') }}" defer></script>
    <script
      src="{{ url_for('static', filename='js/saved.js') }}"
      defer
    ></script>
    <script src="{{ url_for('static', filename='js/fab.js') }}" defer></script>
    <script
      src="{{ url_for('static', filename='js/share.js') }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/global-tts.js') }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/pdf-export.js') }}"
      defer
    ></script>
    <script
      src="{{ url_for('static', filename='js/similar-articles.js') }}"
      defer
    ></script>
  </body>
</html>
